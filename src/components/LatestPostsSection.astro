---
import { getCollection } from 'astro:content';
import { getLangFromUrl } from '../i18n/ui';

// Get latest 3 posts for the current language
const lang = getLangFromUrl(Astro.url);
const allPosts = await getCollection('posts');
const latestPosts = allPosts
  .filter(post => post.data.lang === lang)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);

// Content based on language
const content = {
  en: {
    title: "Latest Insights",
    subtitle: "Stay updated with our latest thoughts and discoveries",
    viewAll: "View All Posts",
    readMore: "Read More"
  },
  es: {
    title: "Últimas Reflexiones",
    subtitle: "Mantente actualizado con nuestros últimos pensamientos y descubrimientos",
    viewAll: "Ver Todos los Artículos",
    readMore: "Leer Más"
  }
};

const currentContent = content[lang as keyof typeof content];
---

<section class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">{currentContent.title}</h2>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        {currentContent.subtitle}
      </p>
    </div>

    <!-- Posts Grid -->
    {latestPosts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
        {latestPosts.map(post => (
          <article class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow">
            {post.data.image && (
              <div class="aspect-video overflow-hidden">
                <img 
                  src={post.data.image} 
                  alt={post.data.title}
                  class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                />
              </div>
            )}
            <div class="p-6">
              <div class="flex items-center gap-2 mb-3">
                {post.data.tags.slice(0, 2).map(tag => (
                  <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                    {tag}
                  </span>
                ))}
              </div>
              <h3 class="text-xl font-bold mb-3 line-clamp-2">
                <a href={`/${lang === 'es' ? 'es/' : ''}posts/${post.slug}/`} class="hover:text-blue-600 transition-colors">
                  {post.data.title}
                </a>
              </h3>
              <p class="text-gray-600 mb-4 line-clamp-3">
                {post.data.description}
              </p>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 text-sm text-gray-500">
                  <span>{post.data.author}</span>
                  <span>•</span>
                  <time datetime={post.data.date.toISOString()}>
                    {post.data.date.toLocaleDateString(lang === 'es' ? 'es-ES' : 'en-US', { 
                      year: 'numeric', 
                      month: 'short', 
                      day: 'numeric' 
                    })}
                  </time>
                </div>
                <a 
                  href={`/${lang === 'es' ? 'es/' : ''}posts/${post.slug}/`}
                  class="text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors"
                >
                  {currentContent.readMore} →
                </a>
              </div>
            </div>
          </article>
        ))}
      </div>
    ) : (
      <!-- No posts message -->
      <div class="text-center py-12">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto">
          <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          <h3 class="text-xl font-bold mb-2">
            {lang === 'es' ? 'No hay artículos aún' : 'No posts yet'}
          </h3>
          <p class="text-gray-600">
            {lang === 'es' 
              ? '¡Vuelve pronto para ver nuestro primer artículo!' 
              : 'Check back soon for our first post!'
            }
          </p>
        </div>
      </div>
    )}

    <!-- View All Button -->
    {latestPosts.length > 0 && (
      <div class="text-center">
        <a 
          href={`/${lang === 'es' ? 'es/' : ''}posts/`}
          class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
        >
          {currentContent.viewAll}
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
    )}
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

